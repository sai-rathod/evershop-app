"use strict";(self.webpackChunkevershop_app=self.webpackChunkevershop_app||[]).push([[7276],{37276:(e,t,i)=>{let o;i.d(t,{default:()=>g});try{if("u">typeof document){var n,r=document.createElement("style");r.appendChild(document.createTextNode('.image-tool{--bg-color: #cdd1e0;--front-color: #388ae5;--border-color: #e8e8eb}.image-tool__image{border-radius:3px;overflow:hidden;margin-bottom:10px;padding-bottom:0}.image-tool__image-picture{max-width:100%;vertical-align:bottom;display:block}.image-tool__image-preloader{width:50px;height:50px;border-radius:50%;background-size:cover;margin:auto;position:relative;background-color:var(--bg-color);background-position:center center}.image-tool__image-preloader:after{content:"";position:absolute;z-index:3;width:60px;height:60px;border-radius:50%;border:2px solid var(--bg-color);border-top-color:var(--front-color);left:50%;top:50%;margin-top:-30px;margin-left:-30px;animation:image-preloader-spin 2s infinite linear;box-sizing:border-box}.image-tool__caption{visibility:hidden;position:absolute;bottom:0;left:0;margin-bottom:10px}.image-tool__caption[contentEditable=true][data-placeholder]:before{position:absolute!important;content:attr(data-placeholder);color:#707684;font-weight:400;display:none}.image-tool__caption[contentEditable=true][data-placeholder]:empty:before{display:block}.image-tool__caption[contentEditable=true][data-placeholder]:empty:focus:before{display:none}.image-tool__link{visibility:hidden;position:absolute;bottom:0;left:0;margin-bottom:10px;margin-top:5px}.image-tool__link[contentEditable=true][data-placeholder]:before{position:absolute!important;content:attr(data-placeholder);color:#707684;font-weight:400;display:none}.image-tool__link[contentEditable=true][data-placeholder]:empty:before{display:block}.image-tool__link[contentEditable=true][data-placeholder]:empty:focus:before{display:none}.image-tool--empty .image-tool__image,.image-tool--empty .image-tool__image-preloader{display:none}.image-tool--empty .image-tool__caption,.image-tool--empty .image-tool__link,.image-tool--uploading .image-tool__caption,.image-tool--uploading .image-tool__link{visibility:hidden!important}.image-tool .cdx-button{display:flex;align-items:center;justify-content:center}.image-tool .cdx-button svg{height:auto;margin:0 6px 0 0}.image-tool--with-background .image-tool__image{padding:15px;background:var(--bg-color);border-radius:5px}.image-tool--stretched .image-tool__image{max-width:none;width:100%}.image-tool--with-background .image-tool__image-picture{width:100%}.image-tool--with-border .image-tool__image{border:1px solid var(--border-color)}.image-tool--focused .image-tool__caption,.image-tool--focused .image-tool__link{visibility:visible!important;position:relative}.image-tool--filled .image-tool__caption,.image-tool--filled .image-tool__link{visibility:visible;position:relative}@keyframes image-preloader-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}')),document.head.appendChild(r)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}let a='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.13968 15.32L8.69058 11.5661C9.02934 11.2036 9.48873 11 9.96774 11C10.4467 11 10.9061 11.2036 11.2449 11.5661L15.3871 16M13.5806 14.0664L15.0132 12.533C15.3519 12.1705 15.8113 11.9668 16.2903 11.9668C16.7693 11.9668 17.2287 12.1705 17.5675 12.533L18.841 13.9634"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.7778 9.33331H13.7867"/></svg>',l='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 9V7.2C8 7.08954 8.08954 7 8.2 7L12 7M16 9V7.2C16 7.08954 15.9105 7 15.8 7L12 7M12 7L12 17M12 17H10M12 17H14"/></svg>';function s(e,t=null,i={}){let o=document.createElement(e);for(let e in Array.isArray(t)?o.classList.add(...t):null!==t&&o.classList.add(t),i)i.hasOwnProperty(e)&&(o[e]=i[e]);return o}var d=((o=d||{}).Empty="empty",o.Uploading="uploading",o.Filled="filled",o);class c{constructor({api:e,config:t,onSelectFile:i,readOnly:o,onImageDimensionsReady:n}){this.api=e,this.config=t,this.onSelectFile=i,this.readOnly=o,this.onImageDimensionsReady=n,this.nodes={wrapper:s("div",[this.CSS.baseClass,this.CSS.wrapper]),imageContainer:s("div",[this.CSS.imageContainer]),fileButton:this.createFileButton(),imageEl:void 0,imagePreloader:s("div",this.CSS.imagePreloader),caption:s("div",[this.CSS.input,this.CSS.caption],{contentEditable:!this.readOnly}),link:s("div",[this.CSS.input,this.CSS.link],{contentEditable:!this.readOnly})},this.nodes.caption.dataset.placeholder=this.config.captionPlaceholder,this.nodes.link.dataset.placeholder=this.config.linkPlaceholder,this.nodes.imageContainer.appendChild(this.nodes.imagePreloader),this.nodes.wrapper.appendChild(this.nodes.imageContainer),this.nodes.wrapper.appendChild(this.nodes.caption),this.nodes.wrapper.appendChild(this.nodes.link),this.nodes.wrapper.appendChild(this.nodes.fileButton)}applyTune(e,t){this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${e}`,t)}render(){return this.toggleStatus("empty"),this.nodes.wrapper}showPreloader(e){this.nodes.imagePreloader.style.backgroundImage=`url(${e})`,this.nodes.imagePreloader.style.display="block",this.toggleStatus("uploading")}hidePreloader(){this.nodes.imagePreloader.style.backgroundImage="",this.toggleStatus("empty")}fillImage(e){this.nodes.imageEl&&this.nodes.imageContainer.removeChild(this.nodes.imageEl);let t=/\.mp4$/.test(e)?"VIDEO":"IMG",i={src:e},o="load";"VIDEO"===t&&(i.autoplay=!0,i.loop=!0,i.muted=!0,i.playsinline=!0,o="loadeddata"),this.nodes.imageEl=s(t,this.CSS.imageEl,i),this.nodes.imageEl.addEventListener(o,()=>{if(this.toggleStatus("filled"),void 0!==this.nodes.imagePreloader&&(this.nodes.imagePreloader.style.backgroundImage="",this.nodes.imagePreloader.style.display="none"),"IMG"===t&&this.onImageDimensionsReady){let e=this.nodes.imageEl,t=e.naturalWidth,i=e.naturalHeight;this.onImageDimensionsReady(t,i)}}),this.nodes.imageContainer.appendChild(this.nodes.imageEl)}fillCaption(e){void 0!==this.nodes.caption&&(this.nodes.caption.innerHTML=e)}fillLink(e){void 0!==this.nodes.link&&(this.nodes.link.innerHTML=e)}toggleStatus(e){for(let t in d)if(Object.prototype.hasOwnProperty.call(d,t)){let i=d[t];this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${i}`,i===e)}}get CSS(){return{baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input,button:this.api.styles.button,wrapper:"image-tool",imageContainer:"image-tool__image",imagePreloader:"image-tool__image-preloader",imageEl:"image-tool__image-picture",caption:"image-tool__caption",link:"image-tool__link"}}createFileButton(){let e=s("div",[this.CSS.button]);return e.innerHTML=this.config.buttonContent??`${a} ${this.api.i18n.t("Select an Image")}`,e.addEventListener("click",()=>{this.onSelectFile()}),e}}var u={exports:{}};window,u.exports=function(){var e=[function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()}catch{"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){(function(e){var o=i(2),n=setTimeout;function r(){}function a(e){if(!(this instanceof a))throw TypeError("Promises must be constructed via new");if("function"!=typeof e)throw TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],h(e,this)}function l(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,a._immediateFn(function(){var i,o=1===e._state?t.onFulfilled:t.onRejected;if(null!==o){try{i=o(e._value)}catch(e){return void d(t.promise,e)}s(t.promise,i)}else(1===e._state?s:d)(t.promise,e._value)})):e._deferreds.push(t)}function s(e,t){try{if(t===e)throw TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof a)return e._state=3,e._value=t,void c(e);if("function"==typeof i)return void h(function(){i.apply(t,arguments)},e)}e._state=1,e._value=t,c(e)}catch(t){d(e,t)}}function d(e,t){e._state=2,e._value=t,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&a._immediateFn(function(){e._handled||a._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)l(e,e._deferreds[t]);e._deferreds=null}function u(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}function h(e,t){var i=!1;try{e(function(e){i||(i=!0,s(t,e))},function(e){i||(i=!0,d(t,e))})}catch(e){if(i)return;i=!0,d(t,e)}}a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var i=new this.constructor(r);return l(this,new u(e,t,i)),i},a.prototype.finally=o.a,a.all=function(e){return new a(function(t,i){if(!e||void 0===e.length)throw TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(e);if(0===o.length)return t([]);for(var n=o.length,r=0;r<o.length;r++)!function e(r,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var l=a.then;if("function"==typeof l)return void l.call(a,function(t){e(r,t)},i)}o[r]=a,0==--n&&t(o)}catch(e){i(e)}}(r,o[r])})},a.resolve=function(e){return e&&"object"==typeof e&&e.constructor===a?e:new a(function(t){t(e)})},a.reject=function(e){return new a(function(t,i){i(e)})},a.race=function(e){return new a(function(t,i){for(var o=0,n=e.length;o<n;o++)e[o].then(t,i)})},a._immediateFn="function"==typeof e&&function(t){e(t)}||function(e){n(e,0)},a._unhandledRejectionFn=function(e){"u">typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},t.a=a}).call(this,i(5).setImmediate)},function(e,t,i){t.a=function(e){var t=this.constructor;return this.then(function(i){return t.resolve(e()).then(function(){return i})},function(i){return t.resolve(e()).then(function(){return t.reject(i)})})}},function(e,t,i){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i(4);var n,r,a,l,s,d,c,u=i(8),h=(r=function(e){return new Promise(function(t,i){e=l(e),(e=s(e)).beforeSend&&e.beforeSend();var o=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");o.open(e.method,e.url),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(e.headers).forEach(function(t){var i=e.headers[t];o.setRequestHeader(t,i)});var n=e.ratio;o.upload.addEventListener("progress",function(t){var i=Math.ceil(Math.round(t.loaded/t.total*100)*n/100);e.progress(Math.min(i,100))},!1),o.addEventListener("progress",function(t){var i=Math.ceil(Math.round(t.loaded/t.total*100)*(100-n)/100)+n;e.progress(Math.min(i,100))},!1),o.onreadystatechange=function(){if(4===o.readyState){var e=o.response;try{e=JSON.parse(e)}catch{}var n=u.parseHeaders(o.getAllResponseHeaders()),r={body:e,code:o.status,headers:n};c(o.status)?t(r):i(r)}},o.send(e.data)})},a=function(e){return e.method="POST",r(e)},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.url&&"string"!=typeof e.url)throw Error("Url must be a string");if(e.url=e.url||"",e.method&&"string"!=typeof e.method)throw Error("`method` must be a string or null");if(e.method=e.method?e.method.toUpperCase():"GET",e.headers&&"object"!==o(e.headers))throw Error("`headers` must be an object or null");if(e.headers=e.headers||{},e.type&&("string"!=typeof e.type||!Object.values(n).includes(e.type)))throw Error("`type` must be taken from module's \xabcontentType\xbb library");if(e.progress&&"function"!=typeof e.progress)throw Error("`progress` must be a function or null");if(e.progress=e.progress||function(e){},e.beforeSend=e.beforeSend||function(e){},e.ratio&&"number"!=typeof e.ratio)throw Error("`ratio` must be a number");if(e.ratio<0||e.ratio>100)throw Error("`ratio` must be in a 0-100 interval");if(e.ratio=e.ratio||90,e.accept&&"string"!=typeof e.accept)throw Error("`accept` must be a string with a list of allowed mime-types");if(e.accept=e.accept||"*/*",e.multiple&&"boolean"!=typeof e.multiple)throw Error("`multiple` must be a true or false");if(e.multiple=e.multiple||!1,e.fieldName&&"string"!=typeof e.fieldName)throw Error("`fieldName` must be a string");return e.fieldName=e.fieldName||"files",e},s=function(e){switch(e.method){case"GET":var t=d(e.data,n.URLENCODED);delete e.data,e.url=/\?/.test(e.url)?e.url+"&"+t:e.url+"?"+t;break;case"POST":case"PUT":case"DELETE":case"UPDATE":var i=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).type||n.JSON}(e);(u.isFormData(e.data)||u.isFormElement(e.data))&&(i=n.FORM),e.data=d(e.data,i),i!==h.contentType.FORM&&(e.headers["content-type"]=i)}return e},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(arguments.length>1?arguments[1]:void 0){case n.URLENCODED:return u.urlEncode(e);case n.JSON:return u.jsonEncode(e);case n.FORM:return u.formEncode(e);default:return e}},c=function(e){return e>=200&&e<300},{contentType:n={URLENCODED:"application/x-www-form-urlencoded; charset=utf-8",FORM:"multipart/form-data",JSON:"application/json; charset=utf-8"},request:r,get:function(e){return e.method="GET",r(e)},post:a,transport:function(e){return e=l(e),u.selectFiles(e).then(function(t){for(var i=new FormData,o=0;o<t.length;o++)i.append(e.fieldName,t[o],t[o].name);u.isObject(e.data)&&Object.keys(e.data).forEach(function(t){var o=e.data[t];i.append(t,o)});var n=e.beforeSend;return e.beforeSend=function(){return n(t)},e.data=i,a(e)})},selectFiles:function(e){return delete(e=l(e)).beforeSend,u.selectFiles(e)}});e.exports=h},function(e,t,i){i.r(t);var o=i(1);window.Promise=window.Promise||o.a},function(e,t,i){(function(e){var o=void 0!==e&&e||"u">typeof self&&self||window,n=Function.prototype.apply;function r(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new r(n.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new r(n.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},i(6),t.setImmediate="u">typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="u">typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(e,t,i){(function(e,t){!function(e,i){if(!e.setImmediate){var o,n,r,a,l,s=1,d={},c=!1,u=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"===({}).toString.call(e.process)?o=function(e){t.nextTick(function(){f(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?(a="setImmediate$"+Math.random()+"$",l=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",l,!1):e.attachEvent("onmessage",l),o=function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){f(e.data)},o=function(e){r.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(n=u.documentElement,o=function(e){var t=u.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):o=function(e){setTimeout(f,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var n={callback:e,args:t};return d[s]=n,o(s),s++},h.clearImmediate=p}function p(e){delete d[e]}function f(e){if(c)setTimeout(f,0,e);else{var t=d[e];if(t){c=!0;try{var o=t.callback,n=t.args;switch(n.length){case 0:o();break;case 1:o(n[0]);break;case 2:o(n[0],n[1]);break;case 3:o(n[0],n[1],n[2]);break;default:o.apply(i,n)}}finally{p(e),c=!1}}}}}(typeof self>"u"?void 0===e?this:e:self)}).call(this,i(0),i(7))},function(e,t){var i,o,n=e.exports={};function r(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch{try{return i.call(null,e,0)}catch{return i.call(this,e,0)}}}try{i="function"==typeof setTimeout?setTimeout:r}catch{i=r}try{o="function"==typeof clearTimeout?clearTimeout:a}catch{o=a}var s,d=[],c=!1,u=-1;function h(){c&&s&&(c=!1,s.length?d=s.concat(d):u=-1,d.length&&p())}function p(){if(!c){var e=l(h);c=!0;for(var t=d.length;t;){for(s=d,d=[];++u<t;)s&&s[u].run();u=-1,t=d.length}s=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch{try{return o.call(null,e)}catch{return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new f(e,t)),1!==d.length||c||l(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,i){var o=i(9);e.exports=function(){function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function")}return function(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(e,[{key:"urlEncode",value:function(e){return o(e)}},{key:"jsonEncode",value:function(e){return JSON.stringify(e)}},{key:"formEncode",value:function(e){if(this.isFormData(e))return e;if(this.isFormElement(e))return new FormData(e);if(this.isObject(e)){var t=new FormData;return Object.keys(e).forEach(function(i){var o=e[i];t.append(i,o)}),t}throw Error("`data` must be an instance of Object, FormData or <FORM> HTMLElement")}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isFormData",value:function(e){return e instanceof FormData}},{key:"isFormElement",value:function(e){return e instanceof HTMLFormElement}},{key:"selectFiles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,i){var o=document.createElement("INPUT");o.type="file",e.multiple&&o.setAttribute("multiple","multiple"),e.accept&&o.setAttribute("accept",e.accept),o.style.display="none",document.body.appendChild(o),o.addEventListener("change",function(e){t(e.target.files),document.body.removeChild(o)},!1),o.click()})}},{key:"parseHeaders",value:function(e){var t=e.trim().split(/[\r\n]+/),i={};return t.forEach(function(e){var t=e.split(": "),o=t.shift(),n=t.join(": ");o&&(i[o]=n)}),i}}]),e}()},function(e,t){var i=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape).replace(/%20/g,"+")},o=function(e,t,n,r){return t=t||null,n=n||"&",r=r||null,e?(function(e){for(var t=[],i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t})(Object.keys(e).map(function(a){var l,s,d=a;if(r&&(d=r+"["+d+"]"),"object"==typeof e[a]&&null!==e[a])l=o(e[a],null,n,d);else{t&&(d=!isNaN(parseFloat(s=d))&&isFinite(s)?t+Number(d):d);var c=e[a];c=(c=0===(c=!1===(c=!0===c?"1":c)?"0":c)?"0":c)||"",l=i(d)+"="+i(c)}return l})).join(n).replace(/[!'()*]/g,""):""};e.exports=o}],t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,(function(t){return e[t]}).bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}();let h=(n=u.exports)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;function p(e){return void 0!==e&&"function"==typeof e.then}class f{constructor({config:e,onUpload:t,onError:i}){this.config=e,this.onUpload=t,this.onError=i}uploadSelectedFile({onPreview:e}){let t,i=function(t){let i=new FileReader;i.readAsDataURL(t),i.onload=t=>{e(t.target.result)}};if(this.config.onSelectFile&&"function"==typeof this.config.onSelectFile){try{this.config.onSelectFile(t=>{t.success&&t.file&&t.file.url?(e(t.file.url),this.onUpload(t)):this.onError("Invalid response format")},this.onError)}catch(e){this.onError(`File selection error: ${e.message||"Unknown error"}`)}return}if(this.config.uploader&&"function"==typeof this.config.uploader.uploadByFile){let e=this.config.uploader.uploadByFile;t=h.selectFiles({accept:this.config.types??"image/*"}).then(t=>{i(t[0]);let o=e(t[0]);return p(o)||console.warn("Custom uploader method uploadByFile should return a Promise"),o})}else t=h.transport({url:this.config.endpoints.byFile,data:this.config.additionalRequestData,accept:this.config.types??"image/*",headers:this.config.additionalRequestHeaders,beforeSend:e=>{i(e[0])},fieldName:this.config.field??"image"}).then(e=>e.body);t.then(e=>{this.onUpload(e)}).catch(e=>{this.onError(e)})}uploadByUrl(e){let t;this.config.uploader&&"function"==typeof this.config.uploader.uploadByUrl?p(t=this.config.uploader.uploadByUrl(e))||console.warn("Custom uploader method uploadByUrl should return a Promise"):t=h.post({url:this.config.endpoints.byUrl,data:Object.assign({url:e},this.config.additionalRequestData),type:h.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(e=>e.body),t.then(e=>{this.onUpload(e)}).catch(e=>{this.onError(e)})}uploadByFile(e,{onPreview:t}){let i,o=new FileReader;if(o.readAsDataURL(e),o.onload=e=>{t(e.target.result)},this.config.uploader&&"function"==typeof this.config.uploader.uploadByFile)p(i=this.config.uploader.uploadByFile(e))||console.warn("Custom uploader method uploadByFile should return a Promise");else{let t=new FormData;t.append(this.config.field??"image",e),this.config.additionalRequestData&&Object.keys(this.config.additionalRequestData).length&&Object.entries(this.config.additionalRequestData).forEach(([e,i])=>{t.append(e,i)}),i=h.post({url:this.config.endpoints.byFile,data:t,type:h.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(e=>e.body)}i.then(e=>{this.onUpload(e)}).catch(e=>{this.onError(e)})}}class g{constructor({data:e,config:t,api:i,readOnly:o,block:n}){this.isCaptionEnabled=null,this.isLinkEnabled=null,this.api=i,this.block=n,this.config={endpoints:t.endpoints,additionalRequestData:t.additionalRequestData,additionalRequestHeaders:t.additionalRequestHeaders,field:t.field,types:t.types,captionPlaceholder:this.api.i18n.t(t.captionPlaceholder??"Caption"),linkPlaceholder:this.api.i18n.t(t.linkPlaceholder??"Link"),buttonContent:t.buttonContent,uploader:t.uploader,onSelectFile:t.onSelectFile,actions:t.actions,features:t.features||{}},this.uploader=new f({config:this.config,onUpload:e=>this.onUpload(e),onError:e=>this.uploadingFailed(e)}),this.ui=new c({api:i,config:this.config,onSelectFile:()=>{this.uploader.uploadSelectedFile({onPreview:e=>{this.ui.showPreloader(e)}})},readOnly:o,onImageDimensionsReady:(e,t)=>{this._data.file&&(this._data.file.width=e,this._data.file.height=t,console.log("Image dimensions detected:",{width:e,height:t,fileData:this._data.file,fullData:this._data}))}}),this._data={caption:"",link:"",withBorder:!1,withBackground:!1,stretched:!1,file:{url:""}},this.data=e}static get isReadOnlySupported(){return!0}static get toolbox(){return{icon:a,title:"Image"}}static get tunes(){return[{name:"withBorder",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 9.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.5 5H14.5096"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.625 5H15C17.2091 5 19 6.79086 19 9V9.375"/><path stroke="currentColor" stroke-width="2" d="M9.375 5L9 5C6.79086 5 5 6.79086 5 9V9.375"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 5H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 9.5H5.00957"/><path stroke="currentColor" stroke-width="2" d="M9.375 19H9C6.79086 19 5 17.2091 5 15V14.625"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 19H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 14.55H5.00957"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/></svg>',title:"With border",toggle:!0},{name:"stretched",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L20 12L17 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 12H20"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L4 12L7 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12H10"/></svg>',title:"Stretch image",toggle:!0},{name:"withBackground",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19V19C9.13623 19 8.20435 19 7.46927 18.6955C6.48915 18.2895 5.71046 17.5108 5.30448 16.5307C5 15.7956 5 14.8638 5 13V12C5 9.19108 5 7.78661 5.67412 6.77772C5.96596 6.34096 6.34096 5.96596 6.77772 5.67412C7.78661 5 9.19108 5 12 5H13.5C14.8956 5 15.5933 5 16.1611 5.17224C17.4395 5.56004 18.44 6.56046 18.8278 7.83886C19 8.40666 19 9.10444 19 10.5V10.5"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.5 17.5L17.5 6.5"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 10.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.9919 19H11.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13L13 5"/></svg>',title:"With background",toggle:!0}]}render(){var e,t,i,o,n;return console.log("Rendering image block with data:",{url:this._data.file.url,width:this._data.file.width,height:this._data.file.height,caption:this._data.caption,link:this._data.link,fullData:this._data}),((null==(e=this.config.features)?void 0:e.caption)===!0||(null==(t=this.config.features)?void 0:t.caption)===void 0||(null==(i=this.config.features)?void 0:i.caption)==="optional"&&this.data.caption)&&(this.isCaptionEnabled=!0,this.ui.applyTune("caption",!0)),((null==(o=this.config.features)?void 0:o.link)===!0||(null==(n=this.config.features)?void 0:n.link)==="optional"&&this.data.link)&&(this.isLinkEnabled=!0,this.ui.applyTune("link",!0)),this.ui.render()}validate(e){return!!e.file.url}save(){let e=this.ui.nodes.caption,t=this.ui.nodes.link;return this._data.caption=e.innerHTML,this._data.link=t.innerHTML,console.log("Saving image data:",{caption:this._data.caption,link:this._data.link,file:this._data.file,dimensions:{width:this._data.file.width,height:this._data.file.height},fullData:this._data}),this.data}renderSettings(){var e,t;let i=g.tunes.concat(this.config.actions||[]),o={border:"withBorder",background:"withBackground",stretch:"stretched",caption:"caption",link:"link"};(null==(e=this.config.features)?void 0:e.caption)==="optional"&&i.push({name:"caption",icon:l,title:"With caption",toggle:!0}),(null==(t=this.config.features)?void 0:t.link)==="optional"&&i.push({name:"link",icon:l,title:"With link",toggle:!0});let n=i.filter(e=>{var t,i,n;let r=Object.keys(o).find(t=>o[t]===e.name);return"caption"===r?(null==(t=this.config.features)?void 0:t.caption)!==!1:"link"===r?(null==(i=this.config.features)?void 0:i.link)!==!1:null==r||(null==(n=this.config.features)?void 0:n[r])!==!1}),r=e=>{let t=this.data[e.name];return"caption"===e.name&&(t=this.isCaptionEnabled??t),"link"===e.name&&(t=this.isLinkEnabled??t),t};return n.map(e=>({icon:e.icon,label:this.api.i18n.t(e.title),name:e.name,toggle:e.toggle,isActive:r(e),onActivate:()=>{if("function"==typeof e.action)return void e.action(e.name);let t=!r(e);"caption"===e.name&&(this.isCaptionEnabled=!this.isCaptionEnabled,t=this.isCaptionEnabled),"link"===e.name&&(this.isLinkEnabled=!this.isLinkEnabled,t=this.isLinkEnabled),this.tuneToggled(e.name,t)}}))}appendCallback(){this.ui.nodes.fileButton.click()}static get pasteConfig(){return{tags:[{img:{src:!0}}],patterns:{image:/https?:\/\/\S+\.(gif|jpe?g|tiff|png|svg|webp)(\?[a-z0-9=]*)?$/i},files:{mimeTypes:["image/*"]}}}async onPaste(e){switch(e.type){case"tag":{let t=e.detail.data;if(/^blob:/.test(t.src)){let e=await (await fetch(t.src)).blob();this.uploadFile(e);break}this.uploadUrl(t.src);break}case"pattern":{let t=e.detail.data;this.uploadUrl(t);break}case"file":{let t=e.detail.file;this.uploadFile(t)}}}set data(e){var t,i;this.image=e.file,this._data.caption=e.caption||"",this._data.link=e.link||"",this.ui.fillCaption(this._data.caption),this.ui.fillLink(this._data.link),g.tunes.forEach(({name:t})=>{let i="u">typeof e[t]&&(!0===e[t]||"true"===e[t]);this.setTune(t,i)}),e.caption?this.setTune("caption",!0):(null==(t=this.config.features)?void 0:t.caption)===!0&&this.setTune("caption",!0),e.link?this.setTune("link",!0):(null==(i=this.config.features)?void 0:i.link)===!0&&this.setTune("link",!0)}get data(){return this._data}set image(e){var t,i;let o=null==(t=this._data.file)?void 0:t.width,n=null==(i=this._data.file)?void 0:i.height;this._data.file=e||{url:""},e&&e.url&&(void 0!==o&&void 0!==n&&void 0===e.width&&void 0===e.height&&(this._data.file.width=o,this._data.file.height=n),this.ui.fillImage(e.url))}onUpload(e){if(e.success&&e.file){let t={url:e.file.url};void 0!==e.file.width&&(t.width=e.file.width),void 0!==e.file.height&&(t.height=e.file.height),this.image=t,console.log("Image uploaded successfully:",{responseFile:e.file,imageSetterParam:t,currentData:this._data,customFileSelection:!!this.config.onSelectFile})}else this.uploadingFailed("incorrect response: "+JSON.stringify(e))}uploadingFailed(e){console.log("Image Tool: uploading failed because of",e),this.api.notifier.show({message:this.api.i18n.t("Couldnâ€™t upload image. Please try another."),style:"error"}),this.ui.hidePreloader()}tuneToggled(e,t){"caption"===e?(this.ui.applyTune(e,t),!1==t&&(this._data.caption="",this.ui.fillCaption(""))):"link"===e?(this.ui.applyTune(e,t),!1==t&&(this._data.link="",this.ui.fillLink(""))):this.setTune(e,t)}setTune(e,t){this._data[e]=t,this.ui.applyTune(e,t),"stretched"===e&&Promise.resolve().then(()=>{this.block.stretched=t}).catch(e=>{console.error(e)})}uploadFile(e){this.uploader.uploadByFile(e,{onPreview:e=>{this.ui.showPreloader(e)}})}uploadUrl(e){this.ui.showPreloader(e),this.uploader.uploadByUrl(e)}}}}]);