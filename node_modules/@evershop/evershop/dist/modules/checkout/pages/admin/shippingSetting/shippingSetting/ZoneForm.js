import { Card } from '@components/admin/Card.js';
import Spinner from '@components/admin/Spinner.js';
import Button from '@components/common/Button.js';
import { Form } from '@components/common/form/Form.js';
import { InputField } from '@components/common/form/InputField.js';
import { ReactSelectField } from '@components/common/form/ReactSelectField.js';
import React from 'react';
import { useForm } from 'react-hook-form';
import { useQuery } from 'urql';
const CountriesQuery = `
  query Country {
    countries {
      value: code
      label: name
      provinces {
        value: code
        label: name
      }
    }
  }
`;
function ZoneForm({ formMethod, saveZoneApi, onSuccess, reload, zone }) {
    var _a, _b, _c;
    const form = useForm();
    const countryWatch = form.watch('country', (_a = zone === null || zone === void 0 ? void 0 : zone.country) === null || _a === void 0 ? void 0 : _a.code);
    const [{ data, fetching, error }] = useQuery({
        query: CountriesQuery
    });
    if (fetching)
        return React.createElement(Spinner, null);
    if (error) {
        return React.createElement("p", { className: "text-critical" }, "Error loading countries");
    }
    return (React.createElement(Card, { title: "Create a shipping zone" },
        React.createElement(Form, { id: "createShippingZone", method: formMethod || 'POST', action: saveZoneApi, submitBtn: false, onSuccess: async () => {
                await reload();
                onSuccess();
            }, form: form },
            React.createElement(Card.Session, { title: "Zone name" },
                React.createElement(InputField, { name: "name", placeholder: "Enter zone name", required: true, validation: { required: 'Zone name is required' }, value: zone === null || zone === void 0 ? void 0 : zone.name })),
            React.createElement(Card.Session, { title: "Country" },
                React.createElement(ReactSelectField, { name: "country", options: data.countries, hideSelectedOptions: false, isMulti: false, "aria-label": "Select country", defaultValue: (_b = zone === null || zone === void 0 ? void 0 : zone.country) === null || _b === void 0 ? void 0 : _b.code })),
            React.createElement(Card.Session, { title: "Provinces/States" },
                React.createElement(ReactSelectField, { name: "provinces", options: ((_c = data.countries.find((c) => c.value === countryWatch)) === null || _c === void 0 ? void 0 : _c.provinces) ||
                        [], hideSelectedOptions: true, isMulti: true, defaultValue: ((zone === null || zone === void 0 ? void 0 : zone.provinces) || []).map((province) => province.code) })),
            React.createElement(Card.Session, null,
                React.createElement("div", { className: "flex justify-end gap-2" },
                    React.createElement(Button, { title: "Save", variant: "primary", onAction: () => {
                            const form = document.getElementById('createShippingZone');
                            if (form) {
                                form.dispatchEvent(new Event('submit', {
                                    cancelable: true,
                                    bubbles: true
                                }));
                            }
                        } }))))));
}
export { ZoneForm };
//# sourceMappingURL=ZoneForm.js.map