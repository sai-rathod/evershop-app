import { NumberField } from '@components/common/form/NumberField.js';
import React from 'react';
import { useFieldArray, useFormContext } from 'react-hook-form';
export function WeightBasedPrice({ lines }) {
    const { control } = useFormContext();
    const { fields, append, remove } = useFieldArray({
        control,
        name: 'weight_based_cost'
    });
    // Initialize the field array with existing lines if it's empty
    React.useEffect(() => {
        if (fields.length === 0 && lines.length > 0) {
            lines.forEach((line) => {
                var _a, _b;
                append({
                    min_weight: (_a = line.minWeight) === null || _a === void 0 ? void 0 : _a.value,
                    cost: (_b = line.cost) === null || _b === void 0 ? void 0 : _b.value
                });
            });
        }
    }, [lines, fields.length, append]);
    // Ensure there's at least one row
    React.useEffect(() => {
        if (lines.length === 0) {
            append({
                min_weight: undefined,
                cost: undefined
            });
        }
    }, [lines.length, append]);
    return (React.createElement("div", { className: "my-5" },
        React.createElement("table", { className: "border-collapse divide-y" },
            React.createElement("thead", null,
                React.createElement("tr", null,
                    React.createElement("th", { className: "border-none" }, "Min Weight"),
                    React.createElement("th", { className: "border-none" }, "Shipping Cost"),
                    React.createElement("th", { className: "border-none" }, "Action"))),
            React.createElement("tbody", null, fields.map((field, index) => (React.createElement("tr", { key: field.id, className: "border-divider py-5" },
                React.createElement("td", { className: "border-none" },
                    React.createElement(NumberField, { name: `weight_based_cost.${index}.min_weight`, placeholder: "Min Weight", required: true, validation: { required: 'Min weight is required' } })),
                React.createElement("td", { className: "border-none" },
                    React.createElement(NumberField, { name: `weight_based_cost.${index}.cost`, placeholder: "Shipping Cost", required: true, validation: { required: 'Shipping cost is required' } })),
                React.createElement("td", { className: "border-none" }, fields.length > 1 && (React.createElement("button", { type: "button", onClick: () => remove(index), className: "text-critical" }, "Delete"))))))),
            React.createElement("tfoot", null,
                React.createElement("tr", null,
                    React.createElement("td", { colSpan: 3, className: "border-none" },
                        React.createElement("button", { type: "button", className: "text-interactive", onClick: () => {
                                append({
                                    min_weight: undefined,
                                    cost: undefined
                                });
                            } }, "+ Add Line")))))));
}
//# sourceMappingURL=WeightBasedPrice.js.map