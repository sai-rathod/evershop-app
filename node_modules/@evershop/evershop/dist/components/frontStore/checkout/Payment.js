import { useCartState } from '@components/frontStore/cart/CartContext.js';
import { useCheckout, useCheckoutDispatch } from '@components/frontStore/checkout/CheckoutContext.js';
import { BillingAddress } from '@components/frontStore/checkout/payment/BillingAddress.js';
import { PaymentMethods } from '@components/frontStore/checkout/payment/PaymentMethods.js';
import { _ } from '@evershop/evershop/lib/locale/translate/_';
import React, { useEffect } from 'react';
import { useWatch } from 'react-hook-form';
import { toast } from 'react-toastify';
export function Payment() {
    const { data: { billingAddress, availablePaymentMethods }, loadingStates: { addingBillingAddress } } = useCartState();
    const { updateCheckoutData } = useCheckoutDispatch();
    const { form } = useCheckout();
    const paymentMethod = useWatch({
        name: 'paymentMethod',
        control: form.control
    });
    useEffect(() => {
        const updatePaymentMethod = async () => {
            try {
                const paymentMethod = form.getValues('paymentMethod');
                const methodDetails = availablePaymentMethods === null || availablePaymentMethods === void 0 ? void 0 : availablePaymentMethods.find((method) => method.code === paymentMethod);
                if (!methodDetails) {
                    throw new Error('Please select a valid payment method');
                }
                updateCheckoutData({ paymentMethod: methodDetails.code });
            }
            catch (error) {
                toast.error(error instanceof Error
                    ? error.message
                    : _('Failed to update shipment'));
            }
        };
        if (paymentMethod) {
            updatePaymentMethod();
        }
    }, [paymentMethod]);
    return (React.createElement("div", { className: "checkout-shipment" },
        React.createElement("h3", null, _('Payment')),
        React.createElement(PaymentMethods, { methods: availablePaymentMethods === null || availablePaymentMethods === void 0 ? void 0 : availablePaymentMethods.map((method) => ({
                ...method
            })), isLoading: addingBillingAddress }),
        React.createElement(BillingAddress, { billingAddress: billingAddress })));
}
//# sourceMappingURL=Payment.js.map